(function(g,a,r,h,u,s,f,$){"use strict";const P=a.findByProps("openMediaModal"),E=a.findByProps("hideActionSheet");function v(t){return new Promise(function(e,n){r.ReactNative.Image.getSize(t,function(i,o){e([i,o])},n)})}async function b(t){const[e,n]=await v(t),{width:i,height:o}=r.ReactNative.Dimensions.get("window");E.hideActionSheet(),P.openMediaModal({initialSources:[{uri:t,sourceURI:t,width:e,height:n}],initialIndex:0,originLayout:{width:128,height:128,x:i/2-64,y:o-64,resizeMode:"fill"}})}function A(t,e){fetch(t).then(function(n){n.blob().then(function(i){const o=new FileReader;o.readAsDataURL(i),o.onloadend=function(){e(o.result)}})})}const{default:N,GuildIconSizes:I}=a.findByProps("GuildIconSizes"),w=a.findByName("Icon"),{FormRow:L}=u.Forms,j=a.findByProps("uploadEmoji"),C=a.findByProps("openLazy","hideActionSheet");function D(t){let{guild:e,emojiNode:n}=t;const i=function(){$.showInputAlert({title:"Emoji name",initialValue:n.alt,placeholder:"bleh",onConfirm:function(o){A(n.src,function(c){j.uploadEmoji({guildId:e.id,image:c,name:o,roles:void 0}).then(function(){f.showToast(`Added ${n.alt} ${n.alt!==o?`as ${o} `:""}to ${e.name}`,s.getAssetIDByName("Check"))}).catch(function(l){f.showToast(l.body.message,s.getAssetIDByName("Small"))})})},confirmText:`Add to ${e.name}`,confirmColor:void 0,cancelText:"Cancel"}),C.hideActionSheet()};return React.createElement(L,{leading:React.createElement(N,{guild:e,size:I.MEDIUM,animate:!1}),label:e.name,trailing:React.createElement(w,{source:s.getAssetIDByName("ic_add_24px")}),onPress:i})}const R=a.findByProps("openLazy","hideActionSheet"),{default:T}=a.find(function(t){return t.default?.render?.name==="ActionSheet"}),{BottomSheetFlatList:x}=a.findByProps("BottomSheetScrollView"),{ActionSheetTitleHeader:z,ActionSheetCloseButton:F}=a.findByProps("ActionSheetTitleHeader"),{FormDivider:_,FormIcon:M}=u.Forms,k=a.findByProps("getGuilds"),G=a.findByProps("can","_dispatcher"),U=function(t){return R.openLazy(new Promise(function(e){return e({default:O})}),"AddToServerActionSheet",{emojiNode:t})};function O(t){let{emojiNode:e}=t;const n=Object.values(k.getGuilds()).filter(function(i){return G.can(r.constants.Permissions.MANAGE_GUILD_EXPRESSIONS,i)});return React.createElement(T,{scrollable:!0},React.createElement(z,{title:`Stealing ${e.alt}`,leading:React.createElement(M,{style:{marginRight:12},source:{uri:e.src},disableColor:!0}),trailing:React.createElement(F,{onPress:function(){return R.hideActionSheet()}})}),React.createElement(x,{style:{flex:1},contentContainerStyle:{paddingBottom:24},data:n,renderItem:function(i){let{item:o}=i;return React.createElement(D,{guild:o,emojiNode:e})},ItemSeparatorComponent:_,keyExtractor:function(i){return i.id}}))}const{default:H,ButtonColors:V,ButtonLooks:ce,ButtonSizes:X}=a.findByProps("ButtonColors","ButtonLooks","ButtonSizes"),m=a.findByProps("openLazy","hideActionSheet"),{downloadMediaAsset:q}=a.findByProps("downloadMediaAsset");function B(t){let{emojiNode:e}=t;const n=[{text:"Add to Server",callback:function(){return U(e)}},{text:"Copy URL to clipboard",callback:function(){r.clipboard.setString(e.src),m.hideActionSheet(),f.showToast(`Copied ${e.alt}'s URL to clipboard`,s.getAssetIDByName("ic_copy_message_link"))}},...r.ReactNative.Platform.select({ios:[{text:"Copy image to clipboard",callback:function(){return A(e.src,function(i){r.clipboard.setImage(i.split(",")[1]),m.hideActionSheet(),f.showToast(`Copied ${e.alt}'s image to clipboard`,s.getAssetIDByName("ic_message_copy"))})}}],default:[]}),{text:`Save image to ${r.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,callback:function(){q(e.src,e.src.includes(".gif")?1:0),m.hideActionSheet(),f.showToast(`Saved ${e.alt}'s image to ${r.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,s.getAssetIDByName("toast_image_saved"))}}];return React.createElement(React.Fragment,null,n.map(function(i){let{text:o,callback:c}=i;return React.createElement(H,{color:V.BRAND,text:o,size:X.SMALL,onPress:c,style:{marginTop:r.ReactNative.Platform.select({android:12,default:16})}})}))}const J=a.findByProps("GuildDetails"),{FormDivider:K}=u.Forms,{TouchableOpacity:Q}=u.General;function W(){return h.after("default",J,function(t,e){let[{emojiNode:n}]=t;if(!n.src)return;const i=e?.props?.children?.props?.children?.props?.children,o=h.after("type",i,function(c,l){let[{emojiNode:p}]=c;r.React.useEffect(function(){return function(){o()}},[]);const d=l.props?.children[0]?.props?.children;d?.[0]?.type?.name==="Icon"&&(d[0]=r.React.createElement(Q,{onPress:function(){return b(p.src.split("?")[0])}},d[0]));const y=l.props?.children[3]?.props?.children;if(y){y.push(r.React.createElement(B,{emojiNode:p}));return}const ae=-~l.props?.children.findIndex(function(re){return re?.type?.name==="Button"})||-2;l.props?.children?.splice(ae,0,r.React.createElement(r.React.Fragment,null,r.React.createElement(K,{style:{marginLeft:0,marginTop:16}}),r.React.createElement(B,{emojiNode:p})))})})}const Y=a.findByProps("hideActionSheet"),Z=a.findByProps("GuildDetails");function ee(t){let{id:e,name:n,animated:i}=t;try{Y.openLazy(Promise.resolve(Z),"MessageEmojiActionSheet",{emojiNode:e?{id:e,alt:n,src:`https://cdn.discordapp.com/emojis/${e}.${i?"gif":"webp"}?size=128`}:{content:n,surrogate:n}})}catch(o){console.log("Failed to open action sheet",o)}}const{default:te}=a.find(function(t){return t.default?.render?.name==="ActionSheet"}),{TouchableOpacity:ne}=u.General;function ie(){return h.before("render",te,function(t){let[e]=t;if(!e?.header?.props?.reactions||e.children.type?.name!=="FastList")return;const n=h.after("type",e.header,function(i,o){r.React.useEffect(function(){return n},[]);try{const c=o.props.children[0],{tabs:l,onSelect:p}=c.props;c.props.tabs=l.map(function(d){return r.React.createElement(ne,{onPress:function(){return p(d.props.index)},onLongPress:function(){const{emoji:y}=d.props.reaction;ee(y)}},d)})}catch{console.error("Failed to patch reaction header")}})})}let S=[];var oe={onLoad:function(){S.push(W()),S.push(ie())},onUnload:function(){for(const t of S)t()}};return g.default=oe,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui.alerts);
