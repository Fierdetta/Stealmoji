(function(m,a,o,h,f,u,p,B){"use strict";const v=a.findByProps("openMediaModal"),P=a.findByProps("hideActionSheet");function b(t){return new Promise(function(e,n){o.ReactNative.Image.getSize(t,function(i,r){e([i,r])},n)})}async function E(t){const[e,n]=await b(t),{width:i,height:r}=o.ReactNative.Dimensions.get("window");P.hideActionSheet(),v.openMediaModal({initialSources:[{uri:t,sourceURI:t,width:e,height:n}],initialIndex:0,originLayout:{width:128,height:128,x:i/2-64,y:r-64,resizeMode:"fill"}})}function A(t,e){fetch(t).then(function(n){n.blob().then(function(i){const r=new FileReader;r.readAsDataURL(i),r.onloadend=function(){e(r.result)}})})}const{default:$,ButtonColors:N,ButtonSizes:j}=a.findByProps("ButtonColors","ButtonLooks","ButtonSizes"),y=a.findByProps("openLazy","hideActionSheet"),{downloadMediaAsset:I}=a.findByProps("downloadMediaAsset"),w=function(t){return y.openLazy(Promise.resolve().then(function(){return ce}),"AddToServerActionSheet",{emojiNode:t})};function R(t){let{emojiNode:e}=t;const n=[{text:"Add to Server",callback:function(){return w(e)}},{text:"Copy URL to clipboard",callback:function(){o.clipboard.setString(e.src),y.hideActionSheet(),p.showToast(`Copied ${e.alt}'s URL to clipboard`,u.getAssetIDByName("ic_copy_message_link"))}},...o.ReactNative.Platform.select({ios:[{text:"Copy image to clipboard",callback:function(){return A(e.src,function(i){o.clipboard.setImage(i.split(",")[1]),y.hideActionSheet(),p.showToast(`Copied ${e.alt}'s image to clipboard`,u.getAssetIDByName("ic_message_copy"))})}}],default:[]}),{text:`Save image to ${o.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,callback:function(){I(e.src,e.src.includes(".gif")?1:0),y.hideActionSheet(),p.showToast(`Saved ${e.alt}'s image to ${o.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,u.getAssetIDByName("toast_image_saved"))}}];return React.createElement(React.Fragment,null,n.map(function(i){let{text:r,callback:c}=i;return React.createElement($,{color:N.BRAND,text:r,size:j.SMALL,onPress:c,style:{marginTop:o.ReactNative.Platform.select({android:12,default:16})}})}))}const L=a.findByProps("GuildDetails"),{FormDivider:_}=f.Forms,{TouchableOpacity:D}=f.General;function T(){return h.after("default",L,function(t,e){let[{emojiNode:n}]=t;if(!n.src)return;const i=e?.props?.children?.props?.children?.props?.children;if(!i)return;const r=h.after("type",i,function(c,l){let[{emojiNode:s}]=c;o.React.useEffect(function(){return function(){return void r()}},[]);const d=l?.props?.children?.[0]?.props?.children;d?.[0]?.type?.Sizes&&(d[0]=o.React.createElement(D,{onPress:function(){return E(s.src.split("?")[0])}},d[0]));const g=l?.props?.children?.[3]?.props?.children;if(g){g.push(o.React.createElement(R,{emojiNode:s}));return}const le=-~l.props?.children?.findIndex?.(function(se){return se?.type?.name==="Button"})||-2;l.props?.children?.splice(le,0,o.React.createElement(o.React.Fragment,null,o.React.createElement(_,{style:{marginLeft:0,marginTop:16}}),o.React.createElement(R,{emojiNode:s})))})})}const x=a.findByProps("convertSurrogateToName"),z=a.findByProps("hideActionSheet"),C=a.findByProps("GuildDetails");function F(t){let{id:e,name:n,animated:i}=t;try{z.openLazy(Promise.resolve(C),"MessageEmojiActionSheet",{emojiNode:e?{id:e,alt:n,src:`https://cdn.discordapp.com/emojis/${e}.${i?"gif":"webp"}?size=128`}:{content:x.convertSurrogateToName(n),surrogate:n}})}catch(r){console.log("Failed to open action sheet",r)}}const M=a.find(function(t){return t.render?.name==="ActionSheet"}),{TouchableOpacity:G}=f.General;function k(){return h.before("render",M,function(t){let[e]=t;if(!e?.header?.props?.reactions||e.children.type?.name!=="FastList")return;const n=h.after("type",e.header,function(i,r){o.React.useEffect(function(){return n},[]);try{const c=r.props.children[0],{tabs:l,onSelect:s}=c.props;c.props.tabs=l.map(function(d){return o.React.createElement(G,{onPress:function(){return s(d.props.index)},onLongPress:function(){const{emoji:g}=d.props.reaction;F(g)}},d)})}catch{console.error("Failed to patch reaction header")}})})}let S=[];var U={onLoad:function(){S.push(T()),S.push(k())},onUnload:function(){for(const t of S)t()}};const{default:O,GuildIconSizes:H}=a.findByProps("GuildIconSizes"),{FormRow:V,FormIcon:X}=f.Forms,q=a.findByProps("uploadEmoji"),J=a.findByStoreName("EmojiStore"),K=a.findByProps("openLazy","hideActionSheet");function Q(t){let{guild:e,emojiNode:n}=t;const i=function(){B.showInputAlert({title:"Emoji name",initialValue:n.alt,placeholder:"bleh",onConfirm:function(c){A(n.src,function(l){q.uploadEmoji({guildId:e.id,image:l,name:c,roles:void 0}).then(function(){p.showToast(`Added ${n.alt} ${n.alt!==c?`as ${c} `:""}to ${e.name}`,u.getAssetIDByName("Check"))}).catch(function(s){p.showToast(s.body.message,u.getAssetIDByName("Small"))})})},confirmText:`Add to ${e.name}`,confirmColor:void 0,cancelText:"Cancel"}),K.hideActionSheet()},r=o.React.useMemo(function(){const c=e.getMaxEmojiSlots(),l=J.getGuilds()[e.id]?.emojis??[],s=n.src.includes(".gif");return l.filter(function(d){return d?.animated===s}).length<c},[]);return o.React.createElement(V,{leading:o.React.createElement(O,{guild:e,size:H.MEDIUM,animate:!1}),disabled:!r,label:e.name,subLabel:r?void 0:"No slots available",trailing:o.React.createElement(X,{style:{opacity:1},source:u.getAssetIDByName("ic_add_24px")}),onPress:i})}const W=a.findByProps("openLazy","hideActionSheet"),Y=a.find(function(t){return t.render?.name==="ActionSheet"}),{BottomSheetFlatList:Z}=a.findByProps("BottomSheetScrollView"),{ActionSheetTitleHeader:ee,ActionSheetCloseButton:te}=a.findByProps("ActionSheetTitleHeader"),{FormDivider:ne,FormIcon:ie}=f.Forms,oe=a.findByProps("getGuilds"),ae=a.findByProps("can","_dispatcher");function re(t){let{emojiNode:e}=t;const n=Object.values(oe.getGuilds()).filter(function(i){return ae.can(o.constants.Permissions.MANAGE_GUILD_EXPRESSIONS,i)});return React.createElement(Y,{scrollable:!0},React.createElement(ee,{title:`Stealing ${e.alt}`,leading:React.createElement(ie,{style:{marginRight:12,opacity:1},source:{uri:e.src},disableColor:!0}),trailing:React.createElement(te,{onPress:function(){return W.hideActionSheet()}})}),React.createElement(Z,{style:{flex:1},contentContainerStyle:{paddingBottom:24},data:n,renderItem:function(i){let{item:r}=i;return React.createElement(Q,{guild:r,emojiNode:e})},ItemSeparatorComponent:ne,keyExtractor:function(i){return i.id}}))}var ce=Object.freeze({__proto__:null,default:re});return m.default=U,Object.defineProperty(m,"__esModule",{value:!0}),m})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui.alerts);
