(function(m,r,i,h,f,u,p,B){"use strict";const b=r.findByProps("openMediaModal"),E=r.findByProps("hideActionSheet");function P(t){return new Promise(function(e,n){i.ReactNative.Image.getSize(t,function(o,a){e([o,a])},n)})}async function v(t){const[e,n]=await P(t),{width:o,height:a}=i.ReactNative.Dimensions.get("window");E.hideActionSheet(),b.openMediaModal({initialSources:[{uri:t,sourceURI:t,width:e,height:n}],initialIndex:0,originLayout:{width:128,height:128,x:o/2-64,y:a-64,resizeMode:"fill"}})}function A(t,e){fetch(t).then(function(n){n.blob().then(function(o){const a=new FileReader;a.readAsDataURL(o),a.onloadend=function(){e(a.result)}})})}const{default:$,ButtonColors:N,ButtonSizes:j}=r.findByProps("ButtonColors","ButtonLooks","ButtonSizes"),y=r.findByProps("openLazy","hideActionSheet"),{downloadMediaAsset:I}=r.findByProps("downloadMediaAsset"),w=function(t){return y.openLazy(Promise.resolve().then(function(){return re}),"AddToServerActionSheet",{emojiNode:t})};function R(t){let{emojiNode:e}=t;const n=[{text:"Add to Server",callback:function(){return w(e)}},{text:"Copy URL to clipboard",callback:function(){i.clipboard.setString(e.src),y.hideActionSheet(),p.showToast(`Copied ${e.alt}'s URL to clipboard`,u.getAssetIDByName("ic_copy_message_link"))}},...i.ReactNative.Platform.select({ios:[{text:"Copy image to clipboard",callback:function(){return A(e.src,function(o){i.clipboard.setImage(o.split(",")[1]),y.hideActionSheet(),p.showToast(`Copied ${e.alt}'s image to clipboard`,u.getAssetIDByName("ic_message_copy"))})}}],default:[]}),{text:`Save image to ${i.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,callback:function(){I(e.src,e.src.includes(".gif")?1:0),y.hideActionSheet(),p.showToast(`Saved ${e.alt}'s image to ${i.ReactNative.Platform.select({android:"Downloads",default:"Camera Roll"})}`,u.getAssetIDByName("toast_image_saved"))}}];return React.createElement(React.Fragment,null,n.map(function(o){let{text:a,callback:c}=o;return React.createElement($,{color:N.BRAND,text:a,size:j.SMALL,onPress:c,style:{marginTop:i.ReactNative.Platform.select({android:12,default:16})}})}))}const L=r.findByProps("GuildDetails"),{FormDivider:_}=f.Forms,{TouchableOpacity:D}=f.General;function x(){return h.after("default",L,function(t,e){let[{emojiNode:n}]=t;if(!n.src)return;const o=e?.props?.children?.props?.children?.props?.children,a=h.after("type",o,function(c,l){let[{emojiNode:s}]=c;i.React.useEffect(function(){return function(){a()}},[]);const d=l.props?.children[0]?.props?.children;d?.[0]?.type?.Sizes&&(d[0]=i.React.createElement(D,{onPress:function(){return v(s.src.split("?")[0])}},d[0]));const g=l.props?.children[3]?.props?.children;if(g){g.push(i.React.createElement(R,{emojiNode:s}));return}const ce=-~l.props?.children.findIndex(function(le){return le?.type?.name==="Button"})||-2;l.props?.children?.splice(ce,0,i.React.createElement(i.React.Fragment,null,i.React.createElement(_,{style:{marginLeft:0,marginTop:16}}),i.React.createElement(R,{emojiNode:s})))})})}const z=r.findByProps("hideActionSheet"),C=r.findByProps("GuildDetails");function F(t){let{id:e,name:n,animated:o}=t;try{z.openLazy(Promise.resolve(C),"MessageEmojiActionSheet",{emojiNode:e?{id:e,alt:n,src:`https://cdn.discordapp.com/emojis/${e}.${o?"gif":"webp"}?size=128`}:{content:n,surrogate:n}})}catch(a){console.log("Failed to open action sheet",a)}}const M=r.find(function(t){return t.render?.name==="ActionSheet"}),{TouchableOpacity:T}=f.General;function G(){return h.before("render",M,function(t){let[e]=t;if(!e?.header?.props?.reactions||e.children.type?.name!=="FastList")return;const n=h.after("type",e.header,function(o,a){i.React.useEffect(function(){return n},[]);try{const c=a.props.children[0],{tabs:l,onSelect:s}=c.props;c.props.tabs=l.map(function(d){return i.React.createElement(T,{onPress:function(){return s(d.props.index)},onLongPress:function(){const{emoji:g}=d.props.reaction;F(g)}},d)})}catch{console.error("Failed to patch reaction header")}})})}let S=[];var k={onLoad:function(){S.push(x()),S.push(G())},onUnload:function(){for(const t of S)t()}};const{default:U,GuildIconSizes:O}=r.findByProps("GuildIconSizes"),{FormRow:H,FormIcon:V}=f.Forms,X=r.findByProps("uploadEmoji"),q=r.findByStoreName("EmojiStore"),J=r.findByProps("openLazy","hideActionSheet");function K(t){let{guild:e,emojiNode:n}=t;const o=function(){B.showInputAlert({title:"Emoji name",initialValue:n.alt,placeholder:"bleh",onConfirm:function(c){A(n.src,function(l){X.uploadEmoji({guildId:e.id,image:l,name:c,roles:void 0}).then(function(){p.showToast(`Added ${n.alt} ${n.alt!==c?`as ${c} `:""}to ${e.name}`,u.getAssetIDByName("Check"))}).catch(function(s){p.showToast(s.body.message,u.getAssetIDByName("Small"))})})},confirmText:`Add to ${e.name}`,confirmColor:void 0,cancelText:"Cancel"}),J.hideActionSheet()},a=i.React.useMemo(function(){const c=e.getMaxEmojiSlots(),l=q.getGuilds()[e.id]?.emojis??[],s=n.src.includes(".gif");return l.filter(function(d){return d?.animated===s}).length<c},[]);return i.React.createElement(H,{leading:i.React.createElement(U,{guild:e,size:O.MEDIUM,animate:!1}),disabled:!a,label:e.name,subLabel:a?void 0:"No slots available",trailing:i.React.createElement(V,{style:{opacity:1},source:u.getAssetIDByName("ic_add_24px")}),onPress:o})}const Q=r.findByProps("openLazy","hideActionSheet"),W=r.find(function(t){return t.render?.name==="ActionSheet"}),{BottomSheetFlatList:Y}=r.findByProps("BottomSheetScrollView"),{ActionSheetTitleHeader:Z,ActionSheetCloseButton:ee}=r.findByProps("ActionSheetTitleHeader"),{FormDivider:te,FormIcon:ne}=f.Forms,ie=r.findByProps("getGuilds"),oe=r.findByProps("can","_dispatcher");function ae(t){let{emojiNode:e}=t;const n=Object.values(ie.getGuilds()).filter(function(o){return oe.can(i.constants.Permissions.MANAGE_GUILD_EXPRESSIONS,o)});return React.createElement(W,{scrollable:!0},React.createElement(Z,{title:`Stealing ${e.alt}`,leading:React.createElement(ne,{style:{marginRight:12,opacity:1},source:{uri:e.src},disableColor:!0}),trailing:React.createElement(ee,{onPress:function(){return Q.hideActionSheet()}})}),React.createElement(Y,{style:{flex:1},contentContainerStyle:{paddingBottom:24},data:n,renderItem:function(o){let{item:a}=o;return React.createElement(K,{guild:a,emojiNode:e})},ItemSeparatorComponent:te,keyExtractor:function(o){return o.id}}))}var re=Object.freeze({__proto__:null,default:ae});return m.default=k,Object.defineProperty(m,"__esModule",{value:!0}),m})({},vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui.components,vendetta.ui.assets,vendetta.ui.toasts,vendetta.ui.alerts);
